{{- define "nova.connInfo.podEnvVars" -}}
{{- $envAll := index . 0 -}}
env:
  - name: SECRET_ADMIN_KEY
    value: NOVA_ADMIN_ENDPOINT
  - name: SECRET_ADMIN_VALUES
    value: {{ include "nova.cluster.endpoint" $envAll | b64enc | quote }}
  - name: SECRET_INTERNAL_KEY
    value: NOVA_INTERNAL_ENDPOINT
  - name: SECRET_INTERNAL_VALUES
    value: {{ include "nova.cluster.endpoint" $envAll | b64enc | quote }}
  - name: SECRET_PUBLIC_KEY
    value: NOVA_PUBLIC_ENDPOINT
  - name: SECRET_PUBLIC_VALUES
    value: {{ include "nova.cluster.endpoint" $envAll | b64enc | quote }}
{{- end -}}

{{- $envAll := index . -}}
{{- $podEnvVars := tuple . | include "nova.connInfo.podEnvVars" | toString | fromYaml }}
{{- $cmUpdateConnInfoJob := dict "envAll" . "serviceName" "nova" "connInfoSecretName" $envAll.Values.openstackDepRelease "podEnvVars" $podEnvVars.env -}}
{{ $cmUpdateConnInfoJob | include "common.manifests.job_update_conn_info" }}
